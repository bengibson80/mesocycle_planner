<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesocycle Volume Planner</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide React icons as inline SVG components
        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const X = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Edit2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Save = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Copy = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        );

        const DEFAULT_EXERCISES = {
            'Barbell Bench Press': { primary: 'Chest', secondary: { 'Triceps': 0.5, 'Front Delts': 0.5 } },
            'Incline Bench Press': { primary: 'Chest', secondary: { 'Triceps': 0.5, 'Front Delts': 0.6 } },
            'Dumbbell Bench Press': { primary: 'Chest', secondary: { 'Triceps': 0.5, 'Front Delts': 0.5 } },
            'Cable Flyes': { primary: 'Chest', secondary: {} },
            'Barbell Row': { primary: 'Back', secondary: { 'Biceps': 0.5, 'Rear Delts': 0.4 } },
            'Pull-ups': { primary: 'Back', secondary: { 'Biceps': 0.5, 'Rear Delts': 0.3 } },
            'Lat Pulldown': { primary: 'Back', secondary: { 'Biceps': 0.5, 'Rear Delts': 0.3 } },
            'Deadlift': { primary: 'Back', secondary: { 'Glutes': 0.5, 'Hamstrings': 0.5, 'Traps': 0.5 } },
            'Overhead Press': { primary: 'Front Delts', secondary: { 'Triceps': 0.5, 'Side Delts': 0.4 } },
            'Lateral Raises': { primary: 'Side Delts', secondary: {} },
            'Rear Delt Flyes': { primary: 'Rear Delts', secondary: {} },
            'Face Pulls': { primary: 'Rear Delts', secondary: { 'Traps': 0.3 } },
            'Squat': { primary: 'Quads', secondary: { 'Glutes': 0.5, 'Hamstrings': 0.3 } },
            'Leg Press': { primary: 'Quads', secondary: { 'Glutes': 0.4, 'Hamstrings': 0.2 } },
            'Leg Extension': { primary: 'Quads', secondary: {} },
            'Romanian Deadlift': { primary: 'Hamstrings', secondary: { 'Glutes': 0.5, 'Back': 0.3 } },
            'Leg Curl': { primary: 'Hamstrings', secondary: {} },
            'Hip Thrust': { primary: 'Glutes', secondary: { 'Hamstrings': 0.3 } },
            'Barbell Curl': { primary: 'Biceps', secondary: {} },
            'Hammer Curl': { primary: 'Biceps', secondary: { 'Forearms': 0.3 } },
            'Triceps Pushdown': { primary: 'Triceps', secondary: {} },
            'Skull Crushers': { primary: 'Triceps', secondary: {} },
            'Close Grip Bench': { primary: 'Triceps', secondary: { 'Chest': 0.5, 'Front Delts': 0.3 } },
        };

        const MUSCLE_GROUPS = ['Chest', 'Back', 'Biceps', 'Triceps', 'Front Delts', 'Side Delts', 'Rear Delts', 
                               'Quads', 'Hamstrings', 'Glutes', 'Calves', 'Traps', 'Abs', 'Forearms'];

        function SpreadsheetMesocyclePlanner() {
            const [exerciseDatabase, setExerciseDatabase] = useState(() => {
                const saved = localStorage.getItem('exerciseDatabase');
                return saved ? JSON.parse(saved) : DEFAULT_EXERCISES;
            });
            
            const [mesocycle, setMesocycle] = useState(() => {
                const saved = localStorage.getItem('currentMesocycle');
                if (saved) return JSON.parse(saved);
                return {
                    name: 'New Mesocycle',
                    days: Array(6).fill(null).map((_, i) => ({
                        dayNumber: i + 1,
                        exercises: []
                    }))
                };
            });

            const [currentDay, setCurrentDay] = useState(1);
            const [currentWeek, setCurrentWeek] = useState(1);
            const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
            const [view, setView] = useState('planner');
            
            const [showExerciseModal, setShowExerciseModal] = useState(false);
            const [editingExercise, setEditingExercise] = useState(null);
            const [newExerciseName, setNewExerciseName] = useState('');
            const [newPrimary, setNewPrimary] = useState('');
            const [newSecondary, setNewSecondary] = useState([]);

            const [showAddExercise, setShowAddExercise] = useState(false);
            const [selectedMuscleGroup, setSelectedMuscleGroup] = useState('');
            const [selectedExercise, setSelectedExercise] = useState('');

            useEffect(() => {
                localStorage.setItem('exerciseDatabase', JSON.stringify(exerciseDatabase));
            }, [exerciseDatabase]);

            useEffect(() => {
                localStorage.setItem('currentMesocycle', JSON.stringify(mesocycle));
            }, [mesocycle]);

            useEffect(() => {
                const handleResize = () => {
                    setIsMobile(window.innerWidth < 768);
                };
                
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            const addExerciseToDay = () => {
                if (!selectedExercise || !selectedMuscleGroup) return;
                
                const exerciseData = exerciseDatabase[selectedExercise];
                const newExercise = {
                    id: Date.now(),
                    name: selectedExercise,
                    muscleGroup: selectedMuscleGroup,
                    data: exerciseData,
                    weeks: [
                        { sets: '', weight: '', reps: '' },
                        { sets: '', weight: '', reps: '' },
                        { sets: '', weight: '', reps: '' },
                        { sets: '', weight: '', reps: '' },
                        { sets: '', weight: '', reps: '' },
                    ]
                };

                const updatedDays = mesocycle.days.map(day => {
                    if (day.dayNumber === currentDay) {
                        return {
                            ...day,
                            exercises: [...day.exercises, newExercise]
                        };
                    }
                    return day;
                });

                setMesocycle({ ...mesocycle, days: updatedDays });
                setShowAddExercise(false);
                setSelectedExercise('');
                setSelectedMuscleGroup('');
            };

            const getFilteredExercises = () => {
                if (!selectedMuscleGroup) return Object.keys(exerciseDatabase);
                return Object.keys(exerciseDatabase).filter(name => 
                    exerciseDatabase[name].primary === selectedMuscleGroup
                );
            };

            const saveToFile = () => {
                const data = {
                    exercises: exerciseDatabase,
                    mesocycle: mesocycle,
                    version: '1.0'
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${mesocycle.name.replace(/\s+/g, '-')}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const loadFromFile = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.exercises) setExerciseDatabase(data.exercises);
                        if (data.mesocycle) setMesocycle(data.mesocycle);
                        alert('Mesocycle loaded successfully!');
                    } catch (err) {
                        alert('Error loading file: ' + err.message);
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            const updateExerciseWeek = (exerciseId, weekIndex, field, value) => {
                const updatedDays = mesocycle.days.map(day => {
                    if (day.dayNumber === currentDay) {
                        return {
                            ...day,
                            exercises: day.exercises.map(ex => {
                                if (ex.id === exerciseId) {
                                    const updatedWeeks = [...ex.weeks];
                                    updatedWeeks[weekIndex] = {
                                        ...updatedWeeks[weekIndex],
                                        [field]: value
                                    };
                                    return { ...ex, weeks: updatedWeeks };
                                }
                                return ex;
                            })
                        };
                    }
                    return day;
                });

                setMesocycle({ ...mesocycle, days: updatedDays });
            };

            const removeExerciseFromDay = (exerciseId) => {
                const updatedDays = mesocycle.days.map(day => {
                    if (day.dayNumber === currentDay) {
                        return {
                            ...day,
                            exercises: day.exercises.filter(ex => ex.id !== exerciseId)
                        };
                    }
                    return day;
                });

                setMesocycle({ ...mesocycle, days: updatedDays });
            };

            const duplicateExerciseToNextDay = (exercise) => {
                const nextDay = currentDay < 6 ? currentDay + 1 : 1;
                
                const newExercise = {
                    ...exercise,
                    id: Date.now(),
                    weeks: exercise.weeks.map(w => ({ ...w }))
                };

                const updatedDays = mesocycle.days.map(day => {
                    if (day.dayNumber === nextDay) {
                        return {
                            ...day,
                            exercises: [...day.exercises, newExercise]
                        };
                    }
                    return day;
                });

                setMesocycle({ ...mesocycle, days: updatedDays });
            };

            const calculateTotalVolume = () => {
                const totals = {};
                
                mesocycle.days.forEach(day => {
                    day.exercises.forEach(exercise => {
                        exercise.weeks.forEach((week, weekIndex) => {
                            if (week.sets && week.sets.toString().trim()) {
                                const sets = parseFloat(week.sets);
                                if (!isNaN(sets) && sets > 0) {
                                    if (!totals[exercise.data.primary]) {
                                        totals[exercise.data.primary] = Array(5).fill(0);
                                    }
                                    totals[exercise.data.primary][weekIndex] += sets;
                                    
                                    Object.entries(exercise.data.secondary).forEach(([muscle, fraction]) => {
                                        if (!totals[muscle]) {
                                            totals[muscle] = Array(5).fill(0);
                                        }
                                        totals[muscle][weekIndex] += sets * fraction;
                                    });
                                }
                            }
                        });
                    });
                });
                
                return totals;
            };

            const openExerciseModal = (exerciseName = null) => {
                if (exerciseName) {
                    const exercise = exerciseDatabase[exerciseName];
                    setEditingExercise(exerciseName);
                    setNewExerciseName(exerciseName);
                    setNewPrimary(exercise.primary);
                    setNewSecondary(Object.entries(exercise.secondary).map(([muscle, fraction]) => ({
                        muscle, fraction
                    })));
                } else {
                    setEditingExercise(null);
                    setNewExerciseName('');
                    setNewPrimary('');
                    setNewSecondary([]);
                }
                setShowExerciseModal(true);
            };

            const saveExercise = () => {
                if (!newExerciseName || !newPrimary) return;
                
                const updatedDatabase = { ...exerciseDatabase };
                
                if (editingExercise && editingExercise !== newExerciseName) {
                    delete updatedDatabase[editingExercise];
                }
                
                const secondaryObj = {};
                newSecondary.forEach(({ muscle, fraction }) => {
                    if (muscle && fraction) {
                        secondaryObj[muscle] = parseFloat(fraction);
                    }
                });
                
                updatedDatabase[newExerciseName] = {
                    primary: newPrimary,
                    secondary: secondaryObj
                };
                
                setExerciseDatabase(updatedDatabase);
                setShowExerciseModal(false);
            };

            const deleteExercise = (name) => {
                if (!confirm(`Delete ${name}?`)) return;
                const updated = { ...exerciseDatabase };
                delete updated[name];
                setExerciseDatabase(updated);
            };

            const addSecondaryMuscle = () => {
                setNewSecondary([...newSecondary, { muscle: '', fraction: 0.5 }]);
            };

            const updateSecondaryMuscle = (index, field, value) => {
                const updated = [...newSecondary];
                updated[index][field] = value;
                setNewSecondary(updated);
            };

            const removeSecondaryMuscle = (index) => {
                setNewSecondary(newSecondary.filter((_, i) => i !== index));
            };

            const exportData = () => {
                const data = {
                    exercises: exerciseDatabase,
                    mesocycle: mesocycle
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'mesocycle-backup.json';
                a.click();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.exercises) setExerciseDatabase(data.exercises);
                        if (data.mesocycle) setMesocycle(data.mesocycle);
                        alert('Data imported successfully!');
                    } catch (err) {
                        alert('Error importing data');
                    }
                };
                reader.readAsText(file);
            };

            const currentDayData = mesocycle.days.find(d => d.dayNumber === currentDay);
            const volumeTotals = calculateTotalVolume();

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-1.5 md:p-4">
                    <div className="max-w-[1800px] mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-lg p-2 md:p-4 mb-2 md:mb-4">
                            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-2 md:gap-3 mb-2 md:mb-3">
                                <div className="flex-1 min-w-0">
                                    <input
                                        type="text"
                                        value={mesocycle.name}
                                        onChange={(e) => setMesocycle({ ...mesocycle, name: e.target.value })}
                                        className="text-lg md:text-2xl font-bold text-slate-900 bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-1 md:px-2 w-full"
                                    />
                                    <p className="text-slate-600 text-[10px] md:text-sm mt-0.5 px-1 md:px-2">5-week training block</p>
                                </div>
                                <div className="flex gap-1.5 md:gap-2 justify-end md:justify-end flex-shrink-0">
                                    <button 
                                        onClick={() => {
                                            const name = prompt('Enter mesocycle name:', 'New Mesocycle');
                                            if (name) {
                                                setMesocycle({
                                                    name: name,
                                                    days: Array(6).fill(null).map((_, i) => ({
                                                        dayNumber: i + 1,
                                                        exercises: []
                                                    }))
                                                });
                                            }
                                        }}
                                        className="px-2.5 md:px-4 py-1.5 md:py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-xs md:text-sm font-medium transition-colors"
                                    >
                                        New
                                    </button>
                                    <button 
                                        onClick={saveToFile} 
                                        className="px-2.5 md:px-4 py-1.5 md:py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs md:text-sm font-medium transition-colors"
                                    >
                                        Save
                                    </button>
                                    <label className="px-2.5 md:px-4 py-1.5 md:py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg text-xs md:text-sm font-medium transition-colors cursor-pointer">
                                        Load
                                        <input type="file" accept=".json" onChange={loadFromFile} className="hidden" />
                                    </label>
                                </div>
                            </div>
                            
                            <div className="flex flex-wrap gap-1.5 md:gap-2">
                                <button
                                    onClick={() => setView('planner')}
                                    className={`px-2.5 md:px-3 py-1 md:py-1.5 rounded-lg text-[11px] md:text-sm font-medium transition-colors ${
                                        view === 'planner' ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                    }`}
                                >
                                    Day Planner
                                </button>
                                <button
                                    onClick={() => setView('summary')}
                                    className={`px-2.5 md:px-3 py-1 md:py-1.5 rounded-lg text-[11px] md:text-sm font-medium transition-colors ${
                                        view === 'summary' ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                    }`}
                                >
                                    Volume Summary
                                </button>
                                <button
                                    onClick={() => setView('exercises')}
                                    className={`px-2.5 md:px-3 py-1 md:py-1.5 rounded-lg text-[11px] md:text-sm font-medium transition-colors ${
                                        view === 'exercises' ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                    }`}
                                >
                                    Exercise Database
                                </button>
                            </div>
                        </div>

                        {/* Day Planner View */}
                        {view === 'planner' && (
                            <div className="space-y-2 md:space-y-4">
                                {/* Day Selector */}
                                <div className="bg-white rounded-2xl shadow-lg p-2 md:p-4">
                                    <h2 className="text-sm md:text-lg font-semibold text-slate-900 mb-2 md:mb-3">Training Days</h2>
                                    <div className="flex gap-1 md:gap-2 flex-wrap">
                                        {[1, 2, 3, 4, 5, 6].map(day => {
                                            const dayData = mesocycle.days.find(d => d.dayNumber === day);
                                            const exerciseCount = dayData?.exercises.length || 0;
                                            
                                            return (
                                                <button
                                                    key={day}
                                                    onClick={() => setCurrentDay(day)}
                                                    className={`px-2.5 md:px-4 py-1.5 md:py-2 rounded-lg text-[11px] md:text-sm font-semibold transition-colors ${
                                                        currentDay === day
                                                            ? 'bg-blue-600 text-white'
                                                            : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                                    }`}
                                                >
                                                    Day {day}
                                                    {exerciseCount > 0 && (
                                                        <span className="ml-1 text-[10px] md:text-xs opacity-75">({exerciseCount})</span>
                                                    )}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* Exercise Table */}
                                <div className="bg-white rounded-2xl shadow-lg p-2 md:p-4">
                                    <div className="flex items-center justify-between mb-3 md:mb-4">
                                        <h2 className="text-sm md:text-lg font-semibold text-slate-900">Day {currentDay}</h2>
                                        <button
                                            onClick={() => setShowAddExercise(true)}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-2 md:px-3 py-1 md:py-1.5 rounded-lg text-[11px] md:text-sm font-medium transition-colors flex items-center gap-1"
                                        >
                                            <Plus size={14} />
                                            <span className="hidden xs:inline md:inline">Add</span>
                                            <span className="hidden sm:inline">Exercise</span>
                                        </button>
                                    </div>

                                    {currentDayData && currentDayData.exercises.length > 0 ? (
                                        <div className="overflow-x-auto">
                                            {/* Mobile View - One Week at a Time */}
                                            {isMobile ? (
                                                <div>
                                                    {/* Week Selector for Mobile */}
                                                    <div className="flex items-center justify-between mb-3 bg-slate-50 p-2 rounded-xl">
                                                        <button
                                                            onClick={() => setCurrentWeek(Math.max(1, currentWeek - 1))}
                                                            disabled={currentWeek === 1}
                                                            className="px-2.5 py-1.5 bg-blue-600 text-white rounded-lg disabled:opacity-30 disabled:bg-slate-300 font-semibold text-xs"
                                                        >
                                                            ← Prev
                                                        </button>
                                                        <div className="text-center">
                                                            <div className="text-base font-bold text-slate-900">Week {currentWeek}</div>
                                                            <div className="text-[10px] text-slate-600">Tap to switch</div>
                                                        </div>
                                                        <button
                                                            onClick={() => setCurrentWeek(Math.min(5, currentWeek + 1))}
                                                            disabled={currentWeek === 5}
                                                            className="px-2.5 py-1.5 bg-blue-600 text-white rounded-lg disabled:opacity-30 disabled:bg-slate-300 font-semibold text-xs"
                                                        >
                                                            Next →
                                                        </button>
                                                    </div>
                                                    
                                                    {/* Week Pills for Quick Navigation */}
                                                    <div className="flex gap-1.5 mb-3 justify-center">
                                                        {[1, 2, 3, 4, 5].map(week => {
                                                            const bgColors = ['bg-blue-100', 'bg-blue-200', 'bg-blue-300', 'bg-blue-400', 'bg-blue-500'];
                                                            return (
                                                                <button
                                                                    key={week}
                                                                    onClick={() => setCurrentWeek(week)}
                                                                    className={`w-10 h-10 rounded-lg font-bold text-xs transition-colors ${
                                                                        currentWeek === week
                                                                            ? bgColors[week - 1] + ' text-white ring-2 ring-blue-600'
                                                                            : 'bg-slate-200 text-slate-600'
                                                                    }`}
                                                                >
                                                                    {week}
                                                                </button>
                                                            );
                                                        })}
                                                    </div>

                                                    {/* Mobile Table - Single Week */}
                                                    <table className="w-full text-sm">
                                                        <thead>
                                                            <tr className="border-b-2 border-slate-200">
                                                                <th className="text-left py-2 px-2 font-semibold text-slate-700 text-xs">Muscle</th>
                                                                <th className="text-left py-2 px-2 font-semibold text-slate-700 text-xs">Exercise</th>
                                                                <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs">Sets</th>
                                                                <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs">Weight</th>
                                                                <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs">Reps</th>
                                                                <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs w-12"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {currentDayData.exercises.map((exercise, idx) => {
                                                                const week = exercise.weeks[currentWeek - 1];
                                                                const bgColors = ['bg-blue-50', 'bg-blue-100', 'bg-blue-200', 'bg-blue-300', 'bg-blue-400'];
                                                                const rowBg = bgColors[currentWeek - 1];
                                                                
                                                                return (
                                                                    <tr key={exercise.id} className={`border-b border-slate-100 ${rowBg}`}>
                                                                        <td className="py-2 px-2 text-xs font-medium text-slate-700">{exercise.muscleGroup}</td>
                                                                        <td className="py-2 px-2 text-xs font-medium text-slate-900">{exercise.name}</td>
                                                                        <td className="py-2 px-1">
                                                                            <input
                                                                                type="text"
                                                                                value={week.sets}
                                                                                onChange={(e) => updateExerciseWeek(exercise.id, currentWeek - 1, 'sets', e.target.value)}
                                                                                className="w-full px-2 py-1 text-center rounded border border-slate-300 focus:border-blue-600 focus:outline-none text-sm bg-white"
                                                                                placeholder="-"
                                                                            />
                                                                        </td>
                                                                        <td className="py-2 px-1">
                                                                            <input
                                                                                type="text"
                                                                                value={week.weight}
                                                                                onChange={(e) => updateExerciseWeek(exercise.id, currentWeek - 1, 'weight', e.target.value)}
                                                                                className="w-full px-2 py-1 text-center rounded border border-slate-300 focus:border-blue-600 focus:outline-none text-sm bg-white"
                                                                                placeholder="-"
                                                                            />
                                                                        </td>
                                                                        <td className="py-2 px-1">
                                                                            <input
                                                                                type="text"
                                                                                value={week.reps}
                                                                                onChange={(e) => updateExerciseWeek(exercise.id, currentWeek - 1, 'reps', e.target.value)}
                                                                                className="w-full px-2 py-1 text-center rounded border border-slate-300 focus:border-blue-600 focus:outline-none text-sm bg-white"
                                                                                placeholder="-"
                                                                            />
                                                                        </td>
                                                                        <td className="py-2 px-1">
                                                                            <div className="flex gap-0.5 justify-center">
                                                                                <button
                                                                                    onClick={() => duplicateExerciseToNextDay(exercise)}
                                                                                    className="p-1 hover:bg-blue-100 rounded transition-colors text-blue-600"
                                                                                    title="Copy to next day"
                                                                                >
                                                                                    <Copy size={14} />
                                                                                </button>
                                                                                <button
                                                                                    onClick={() => removeExerciseFromDay(exercise.id)}
                                                                                    className="p-1 hover:bg-red-100 rounded transition-colors text-red-600"
                                                                                    title="Remove"
                                                                                >
                                                                                    <X size={14} />
                                                                                </button>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                );
                                                            })}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ) : (
                                                /* Desktop View - All Weeks */
                                                <table className="w-full text-sm">
                                                <thead>
                                                    <tr className="border-b-2 border-slate-200">
                                                        <th className="text-left py-2 px-2 font-semibold text-slate-700 text-xs sticky left-0 bg-white">Muscle</th>
                                                        <th className="text-left py-2 px-2 font-semibold text-slate-700 text-xs sticky left-[80px] bg-white">Exercise</th>
                                                        <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs bg-blue-50" colSpan="3">Week 1</th>
                                                        <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs bg-blue-100" colSpan="3">Week 2</th>
                                                        <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs bg-blue-200" colSpan="3">Week 3</th>
                                                        <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs bg-blue-300" colSpan="3">Week 4</th>
                                                        <th className="text-center py-2 px-1 font-semibold text-slate-800 text-xs bg-blue-400" colSpan="3">Week 5</th>
                                                        <th className="text-center py-2 px-1 font-semibold text-slate-700 text-xs w-16"></th>
                                                    </tr>
                                                    <tr className="border-b border-slate-200">
                                                        <th className="py-1 sticky left-0 bg-white"></th>
                                                        <th className="py-1 sticky left-[80px] bg-white"></th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-50">S</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-50">W</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-50">R</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-100">S</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-100">W</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-100">R</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-200">S</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-200">W</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-200">R</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-300">S</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-300">W</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-600 bg-blue-300">R</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-700 bg-blue-400">S</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-700 bg-blue-400">W</th>
                                                        <th className="text-center py-1 px-1 text-xs text-slate-700 bg-blue-400">R</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {currentDayData.exercises.map((exercise, idx) => (
                                                        <tr key={exercise.id} className={`border-b border-slate-100 ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50'}`}>
                                                            <td className="py-1.5 px-2 text-xs font-medium text-slate-700 sticky left-0 bg-inherit">{exercise.muscleGroup}</td>
                                                            <td className="py-1.5 px-2 text-xs font-medium text-slate-900 sticky left-[80px] bg-inherit">{exercise.name}</td>
                                                            
                                                            {exercise.weeks.map((week, weekIdx) => {
                                                                const bgColors = ['bg-blue-50', 'bg-blue-100', 'bg-blue-200', 'bg-blue-300', 'bg-blue-400'];
                                                                const bgColor = bgColors[weekIdx];
                                                                
                                                                return (
                                                                    <React.Fragment key={weekIdx}>
                                                                        <td className={`py-1 px-1 ${bgColor}`}>
                                                                            <input
                                                                                type="text"
                                                                                value={week.sets}
                                                                                onChange={(e) => updateExerciseWeek(exercise.id, weekIdx, 'sets', e.target.value)}
                                                                                className="w-10 px-1 py-0.5 text-center rounded border border-slate-300 focus:border-blue-600 focus:outline-none text-xs bg-white"
                                                                                placeholder="-"
                                                                            />
                                                                        </td>
                                                                        <td className={`py-1 px-1 ${bgColor}`}>
                                                                            <input
                                                                                type="text"
                                                                                value={week.weight}
                                                                                onChange={(e) => updateExerciseWeek(exercise.id, weekIdx, 'weight', e.target.value)}
                                                                                className="px-1 py-0.5 text-center rounded border border-slate-300 focus:border-blue-600 focus:outline-none text-xs bg-white"
                                                                                style={{ width: `${Math.max(3, week.weight.length || 1) * 7 + 8}px` }}
                                                                                placeholder="-"
                                                                            />
                                                                        </td>
                                                                        <td className={`py-1 px-1 ${bgColor}`}>
                                                                            <input
                                                                                type="text"
                                                                                value={week.reps}
                                                                                onChange={(e) => updateExerciseWeek(exercise.id, weekIdx, 'reps', e.target.value)}
                                                                                className="px-1 py-0.5 text-center rounded border border-slate-300 focus:border-blue-600 focus:outline-none text-xs bg-white"
                                                                                style={{ width: `${Math.max(3, week.reps.length || 1) * 7 + 8}px` }}
                                                                                placeholder="-"
                                                                            />
                                                                        </td>
                                                                    </React.Fragment>
                                                                );
                                                            })}
                                                            
                                                            <td className="py-1 px-1">
                                                                <div className="flex gap-0.5 justify-center">
                                                                    <button
                                                                        onClick={() => duplicateExerciseToNextDay(exercise)}
                                                                        className="p-1 hover:bg-blue-100 rounded transition-colors text-blue-600"
                                                                        title="Copy to next day"
                                                                    >
                                                                        <Copy size={14} />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => removeExerciseFromDay(exercise.id)}
                                                                        className="p-1 hover:bg-red-100 rounded transition-colors text-red-600"
                                                                        title="Remove"
                                                                    >
                                                                        <X size={14} />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                            )}
                                        </div>
                                    ) : (
                                        <div className="text-center py-8 text-slate-500 text-sm">
                                            No exercises added yet. Click "Add Exercise" to get started.
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Volume Summary View */}
                        {view === 'summary' && (
                            <div className="bg-white rounded-2xl shadow-lg p-2 md:p-4">
                                <h2 className="text-base md:text-lg font-semibold text-slate-900 mb-3 md:mb-4">Weekly Volume Totals</h2>
                                
                                {Object.keys(volumeTotals).length > 0 ? (
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead>
                                                <tr className="border-b-2 border-slate-200">
                                                    <th className="text-left py-2 px-3 font-semibold text-slate-700 text-xs">Muscle Group</th>
                                                    <th className="text-center py-2 px-2 font-semibold text-slate-700 text-xs bg-blue-50">Week 1</th>
                                                    <th className="text-center py-2 px-2 font-semibold text-slate-700 text-xs bg-blue-100">Week 2</th>
                                                    <th className="text-center py-2 px-2 font-semibold text-slate-700 text-xs bg-blue-200">Week 3</th>
                                                    <th className="text-center py-2 px-2 font-semibold text-slate-700 text-xs bg-blue-300">Week 4</th>
                                                    <th className="text-center py-2 px-2 font-semibold text-slate-800 text-xs bg-blue-400">Week 5</th>
                                                    <th className="text-center py-2 px-2 font-semibold text-slate-700 text-xs">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {Object.entries(volumeTotals)
                                                    .sort((a, b) => b[1].reduce((sum, v) => sum + v, 0) - a[1].reduce((sum, v) => sum + v, 0))
                                                    .map(([muscle, volumes]) => {
                                                        const total = volumes.reduce((sum, v) => sum + v, 0);
                                                        const bgColors = ['bg-blue-50', 'bg-blue-100', 'bg-blue-200', 'bg-blue-300', 'bg-blue-400'];
                                                        
                                                        return (
                                                            <tr key={muscle} className="border-b border-slate-100">
                                                                <td className="py-2 px-3 font-medium text-slate-900">{muscle}</td>
                                                                {volumes.map((volume, idx) => (
                                                                    <td key={idx} className={`py-2 px-2 text-center ${bgColors[idx]}`}>
                                                                        <span className={`inline-block px-2 py-0.5 rounded text-xs font-semibold ${
                                                                            volume > 0 ? 'bg-white text-blue-800' : 'text-slate-400'
                                                                        }`}>
                                                                            {volume > 0 ? volume.toFixed(1) : '-'}
                                                                        </span>
                                                                    </td>
                                                                ))}
                                                                <td className="py-2 px-2 text-center">
                                                                    <span className="inline-block px-2 py-0.5 rounded text-xs font-bold bg-slate-800 text-white">
                                                                        {total.toFixed(1)}
                                                                    </span>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                            </tbody>
                                        </table>
                                    </div>
                                ) : (
                                    <div className="text-center py-8 text-slate-500 text-sm">
                                        No volume data yet. Add exercises to your training days.
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Exercise Database View */}
                        {view === 'exercises' && (
                            <div className="bg-white rounded-2xl shadow-lg p-2 md:p-4">
                                <div className="flex items-center justify-between mb-3 md:mb-4">
                                    <h2 className="text-base md:text-lg font-semibold text-slate-900">Exercise Database</h2>
                                    <button
                                        onClick={() => openExerciseModal()}
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-2 md:px-3 py-1 md:py-1.5 rounded-lg text-xs md:text-sm font-medium transition-colors flex items-center gap-1"
                                    >
                                        <Plus size={14} className="md:hidden" />
                                        <Plus size={16} className="hidden md:block" />
                                        <span className="hidden sm:inline">Add Exercise</span>
                                        <span className="sm:hidden">Add</span>
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                    {Object.entries(exerciseDatabase).sort().map(([name, data]) => (
                                        <div key={name} className="bg-slate-50 rounded-xl p-3">
                                            <div className="flex items-start justify-between mb-1">
                                                <h3 className="font-semibold text-slate-900 text-sm">{name}</h3>
                                                <div className="flex gap-0.5">
                                                    <button
                                                        onClick={() => openExerciseModal(name)}
                                                        className="p-1 hover:bg-blue-100 rounded transition-colors text-blue-600"
                                                    >
                                                        <Edit2 size={14} />
                                                    </button>
                                                    <button
                                                        onClick={() => deleteExercise(name)}
                                                        className="p-1 hover:bg-red-100 rounded transition-colors text-red-600"
                                                    >
                                                        <Trash2 size={14} />
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="space-y-0.5 text-xs">
                                                <div className="text-blue-700 font-medium">Primary: {data.primary}</div>
                                                {Object.keys(data.secondary).length > 0 && (
                                                    <div className="text-slate-600">
                                                        Secondary:
                                                        {Object.entries(data.secondary).map(([muscle, fraction]) => (
                                                            <div key={muscle} className="ml-2">• {muscle} ({fraction})</div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Add Exercise Modal */}
                        {showAddExercise && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 md:p-4 z-50">
                                <div className="bg-white rounded-2xl md:rounded-3xl shadow-2xl p-3 md:p-6 max-w-lg w-full">
                                    <h2 className="text-lg md:text-2xl font-bold text-slate-900 mb-3 md:mb-6">Add Exercise to Day {currentDay}</h2>
                                    
                                    <div className="space-y-3 md:space-y-4">
                                        <div>
                                            <label className="block text-xs md:text-sm font-medium text-slate-700 mb-1.5 md:mb-2">Muscle Group</label>
                                            <select
                                                value={selectedMuscleGroup}
                                                onChange={(e) => {
                                                    setSelectedMuscleGroup(e.target.value);
                                                    setSelectedExercise(''); // Clear exercise when muscle group changes
                                                }}
                                                className="w-full px-3 md:px-4 py-2 md:py-3 rounded-xl md:rounded-2xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none transition-colors text-sm md:text-base"
                                            >
                                                <option value="">Select muscle group...</option>
                                                {MUSCLE_GROUPS.map(muscle => (
                                                    <option key={muscle} value={muscle}>{muscle}</option>
                                                ))}
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-xs md:text-sm font-medium text-slate-700 mb-1.5 md:mb-2">Exercise</label>
                                            <select
                                                value={selectedExercise}
                                                onChange={(e) => setSelectedExercise(e.target.value)}
                                                className="w-full px-3 md:px-4 py-2 md:py-3 rounded-xl md:rounded-2xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none transition-colors text-sm md:text-base"
                                                disabled={!selectedMuscleGroup}
                                            >
                                                <option value="">Select exercise...</option>
                                                {getFilteredExercises().sort().map(ex => (
                                                    <option key={ex} value={ex}>{ex}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    <div className="flex gap-2 md:gap-3 mt-4 md:mt-6">
                                        <button
                                            onClick={addExerciseToDay}
                                            disabled={!selectedExercise || !selectedMuscleGroup}
                                            className="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-semibold py-2 md:py-3 rounded-xl md:rounded-2xl transition-colors flex items-center justify-center gap-1.5 md:gap-2 text-sm md:text-base"
                                        >
                                            <Plus size={16} className="md:hidden" />
                                            <Plus size={20} className="hidden md:block" />
                                            Add Exercise
                                        </button>
                                        <button
                                            onClick={() => setShowAddExercise(false)}
                                            className="px-4 md:px-6 py-2 md:py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold rounded-xl md:rounded-2xl transition-colors text-sm md:text-base"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Exercise Database Modal */}
                        {showExerciseModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-3xl shadow-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                    <h2 className="text-2xl font-bold text-slate-900 mb-6">
                                        {editingExercise ? 'Edit Exercise' : 'Add Exercise'}
                                    </h2>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Exercise Name</label>
                                            <input
                                                type="text"
                                                value={newExerciseName}
                                                onChange={(e) => setNewExerciseName(e.target.value)}
                                                className="w-full px-4 py-3 rounded-2xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                placeholder="e.g., Bulgarian Split Squat"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Primary Muscle</label>
                                            <select
                                                value={newPrimary}
                                                onChange={(e) => setNewPrimary(e.target.value)}
                                                className="w-full px-4 py-3 rounded-2xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none transition-colors"
                                            >
                                                <option value="">Select primary muscle...</option>
                                                {MUSCLE_GROUPS.map(muscle => (
                                                    <option key={muscle} value={muscle}>{muscle}</option>
                                                ))}
                                            </select>
                                        </div>

                                        <div>
                                            <div className="flex items-center justify-between mb-2">
                                                <label className="block text-sm font-medium text-slate-700">Secondary Muscles</label>
                                                <button
                                                    onClick={addSecondaryMuscle}
                                                    className="text-blue-600 hover:text-blue-700 text-sm font-medium"
                                                >
                                                    + Add Secondary
                                                </button>
                                            </div>
                                            
                                            <div className="space-y-2">
                                                {newSecondary.map((sec, index) => (
                                                    <div key={index} className="flex gap-2">
                                                        <select
                                                            value={sec.muscle}
                                                            onChange={(e) => updateSecondaryMuscle(index, 'muscle', e.target.value)}
                                                            className="flex-1 px-4 py-2 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                        >
                                                            <option value="">Select muscle...</option>
                                                            {MUSCLE_GROUPS.filter(m => m !== newPrimary).map(muscle => (
                                                                <option key={muscle} value={muscle}>{muscle}</option>
                                                            ))}
                                                        </select>
                                                        
                                                        <input
                                                            type="number"
                                                            value={sec.fraction}
                                                            onChange={(e) => updateSecondaryMuscle(index, 'fraction', e.target.value)}
                                                            min="0"
                                                            max="1"
                                                            step="0.1"
                                                            className="w-24 px-4 py-2 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                            placeholder="0.5"
                                                        />
                                                        
                                                        <button
                                                            onClick={() => removeSecondaryMuscle(index)}
                                                            className="p-2 hover:bg-red-100 rounded-xl transition-colors text-red-600"
                                                        >
                                                            <X size={20} />
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex gap-3 mt-6">
                                        <button
                                            onClick={saveExercise}
                                            disabled={!newExerciseName || !newPrimary}
                                            className="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-2xl transition-colors flex items-center justify-center gap-2"
                                        >
                                            <Save size={20} />
                                            Save Exercise
                                        </button>
                                        <button
                                            onClick={() => setShowExerciseModal(false)}
                                            className="px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold rounded-2xl transition-colors"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SpreadsheetMesocyclePlanner />);
    </script>
</body>
</html>
